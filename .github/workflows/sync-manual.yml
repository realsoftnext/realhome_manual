name: Sync Manual to App

on:
  push:
    branches:
      - main
    paths:
      - 'manual/**/*.md'

permissions:
  contents: write

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Sync manual files
        run: |
          for file in manual/*.md; do
            if [ "$file" != "manual/README.md" ]; then
              filename=$(basename "$file" .md)
              targetDir="app/manual/$filename"
              contentFile="$targetDir/content.mdx"
              wrapperFile="$targetDir/page.js"
              
              mkdir -p "$targetDir"
              cp "$file" "$contentFile"
              
              if [ ! -f "$wrapperFile" ]; then
                echo "import Content from './content.mdx'" > "$wrapperFile"
                echo "" >> "$wrapperFile"
                echo "export default function Page() {" >> "$wrapperFile"
                echo "  return <Content />" >> "$wrapperFile"
                echo "}" >> "$wrapperFile"
              fi
              
              echo "Synced: $file -> $contentFile"
            fi
          done
      
      - name: Commit and push if changed
        run: |
          git config --global user.name 'GitHub Actions'
          git config --global user.email 'actions@github.com'
          git add app/manual/
          git diff --quiet && git diff --staged --quiet || (git commit -m "Auto-sync: manual to app/manual" && git push)
